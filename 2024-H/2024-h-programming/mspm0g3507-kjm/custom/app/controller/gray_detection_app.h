#ifndef GRAY_DETECTION_H__
#define GRAY_DETECTION_H__

#include "pca9555.h"

// ====================================================================
// ⭐ 关键配置：请在此处定义您使用的传感器数量 (3到12)
// ====================================================================
#define TRACK_SENSOR_COUNT 12 // <--- 修改这里，例如 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
#define USE_PCA9555 			 1

void gray_detection_init(void);
float gray_read_data(void);
uint16_t gray_read_byte(void);

#if !USE_PCA9555 
typedef struct {
		GPIO_Regs* port;
		uint32_t pin;
} gpio_struct_t;
#endif

static const struct
{
    uint16_t input; 
    float output;
} lookup_table[] = {

#if (TRACK_SENSOR_COUNT == 3) // ⭐ 3路传感器 (中心: 1)
    // 单个传感器
    {0x01, -1.0f}, // 0b001 (bit 0)
    {0x02, 0.0f},  // 0b010 (bit 1) ⭐ 中心
    {0x04, 1.0f},  // 0b100 (bit 2)
    // 两个传感器
    {0x03, -0.5f}, // 0b011 (bit 0,1)
    {0x06, 0.5f},  // 0b110 (bit 1,2)

#elif (TRACK_SENSOR_COUNT == 4) // ⭐ 4路传感器 (中心: 1.5)
    // 单个传感器
    {0x01, -1.5f}, // 0b0001 (bit 0)
    {0x02, -0.5f}, // 0b0010 (bit 1)
    {0x04, 0.5f},  // 0b0100 (bit 2)
    {0x08, 1.5f},  // 0b1000 (bit 3)
    // 两个传感器
    {0x03, -1.0f}, // 0b0011 (bit 0,1)
    {0x06, 0.0f},  // 0b0110 (bit 1,2) ⭐ 中心
    {0x0C, 1.0f},  // 0b1100 (bit 2,3)
    // 三个传感器
    {0x07, -0.5f}, // 0b0111 (bit 0,1,2)
    {0x0E, 0.5f},  // 0b1110 (bit 1,2,3)

#elif (TRACK_SENSOR_COUNT == 5) // ⭐ 5路传感器 (中心: 2)
    // 单个传感器
    {0x01, -2.0f}, // 0b00001 (bit 0)
    {0x02, -1.0f}, // 0b00010 (bit 1)
    {0x04, 0.0f},  // 0b00100 (bit 2) ⭐ 中心
    {0x08, 1.0f},  // 0b01000 (bit 3)
    {0x10, 2.0f},  // 0b10000 (bit 4)
    // 两个传感器
    {0x03, -1.5f}, // 0b00011 (bit 0,1)
    {0x06, -0.5f}, // 0b00110 (bit 1,2)
    {0x0C, 0.5f},  // 0b01100 (bit 2,3)
    {0x18, 1.5f},  // 0b11000 (bit 3,4)
    // 三个传感器
    {0x07, -1.0f}, // 0b00111 (bit 0,1,2)
    {0x0E, 0.0f},  // 0b01110 (bit 1,2,3) ⭐ 中心
    {0x1C, 1.0f},  // 0b11100 (bit 2,3,4)

#elif (TRACK_SENSOR_COUNT == 6) // ⭐ 6路传感器 (中心: 2.5)
    // 单个传感器
    {0x01, -2.5f}, // 0b000001 (bit 0)
    {0x02, -1.5f}, // 0b000010 (bit 1)
    {0x04, -0.5f}, // 0b000100 (bit 2)
    {0x08, 0.5f},  // 0b001000 (bit 3)
    {0x10, 1.5f},  // 0b010000 (bit 4)
    {0x20, 2.5f},  // 0b100000 (bit 5)
    // 两个传感器
    {0x03, -2.0f}, // 0b000011 (bit 0,1)
    {0x06, -1.0f}, // 0b000110 (bit 1,2)
    {0x0C, 0.0f},  // 0b001100 (bit 2,3) ⭐ 中心
    {0x18, 1.0f},  // 0b011000 (bit 3,4)
    {0x30, 2.0f},  // 0b110000 (bit 4,5)
    // 三个传感器
    {0x07, -1.5f}, // 0b000111 (bit 0,1,2)
    {0x0E, -0.5f}, // 0b001110 (bit 1,2,3)
    {0x1C, 0.5f},  // 0b011100 (bit 2,3,4)
    {0x38, 1.5f},  // 0b111000 (bit 3,4,5)

#elif (TRACK_SENSOR_COUNT == 7) // ⭐ 7路传感器 (中心: 3)
    // 单个传感器
    {0x01, -3.0f}, // 0b0000001 (bit 0)
    {0x02, -2.0f}, // 0b0000010 (bit 1)
    {0x04, -1.0f}, // 0b0000100 (bit 2)
    {0x08, 0.0f},  // 0b0001000 (bit 3) ⭐ 中心
    {0x10, 1.0f},  // 0b0010000 (bit 4)
    {0x20, 2.0f},  // 0b0100000 (bit 5)
    {0x40, 3.0f},  // 0b1000000 (bit 6)
    // 两个传感器
    {0x03, -2.5f}, // 0b0000011 (bit 0,1)
    {0x06, -1.5f}, // 0b0000110 (bit 1,2)
    {0x0C, -0.5f}, // 0b0001100 (bit 2,3)
    {0x18, 0.5f},  // 0b0011000 (bit 3,4)
    {0x30, 1.5f},  // 0b0110000 (bit 4,5)
    {0x60, 2.5f},  // 0b1100000 (bit 5,6)
    // 三个传感器
    {0x07, -2.0f}, // 0b0000111 (bit 0,1,2)
    {0x0E, -1.0f}, // 0b0001110 (bit 1,2,3)
    {0x1C, 0.0f},  // 0b0011100 (bit 2,3,4) ⭐ 中心
    {0x38, 1.0f},  // 0b0111000 (bit 3,4,5)
    {0x70, 2.0f},  // 0b1110000 (bit 4,5,6)

#elif (TRACK_SENSOR_COUNT == 8) // ⭐ 8路传感器 (中心: 3.5)
    {0x01, -3.5},   // 00000001b (bit 0) - 最左端
    {0x02, -2.5},   // 00000010b (bit 1)
    {0x04, -1.5},   // 00000100b (bit 2)
    {0x08, -0.5},   // 00001000b (bit 3)
    {0x10,  0.0},   // 00010000b (bit 4) ⭐ 中心
    {0x20,  0.5},   // 00100000b (bit 5)
    {0x40,  1.5},   // 01000000b (bit 6)
    {0x80,  2.5},   // 10000000b (bit 7) - 最右端
    // ⭐ 两个相邻传感器检测 - 中心为传感器4,5
    {0x03, -3.0},   // 00000011b (bit 0,1)
    {0x06, -2.0},   // 00000110b (bit 1,2)
    {0x0C, -1.0},   // 00001100b (bit 2,3)
    {0x18,  0.0},   // 00011000b (bit 3,4) ⭐ 双线中心
    {0x30,  1.0},   // 00110000b (bit 4,5)
    {0x60,  2.0},   // 01100000b (bit 5,6)
    {0xC0,  3.0},   // 11000000b (bit 6,7)
    // 三个相邻传感器检测（宽线条）
    {0x07, -2.5},   // 00000111b (bit 0,1,2) - 最左端三个
    {0x0E, -1.5},   // 00001110b (bit 1,2,3)
    {0x1C, -0.5},   // 00011100b (bit 2,3,4) - 左偏中心
    {0x38,  0.5},   // 00111000b (bit 3,4,5) - 右偏中心
    {0x70,  1.5},   // 01110000b (bit 4,5,6)
    {0xE0,  2.5},   // 11100000b (bit 5,6,7) - 最右端三个
    // 四个相邻传感器（非常宽的线条）
    {0x0F, -2.0},   // 00001111b (bit 0,1,2,3) - 最左端四个
    {0x1E, -1.0},   // 00011110b (bit 1,2,3,4) - 左偏超宽
    {0x3C,  0.0},   // 00111100b (bit 2,3,4,5) ⭐ 中心
    {0x78,  1.0},   // 01111000b (bit 3,4,5,6) - 右偏超宽
    {0xF0,  2.0},   // 11110000b (bit 4,5,6,7) - 最右端四个
    // 特殊情况：分离的传感器检测（噪声或多线检测）
    {0x05, -2.0},   // 00000101b (bit 0,2)
    {0x0A, -1.5},   // 00001010b (bit 1,3)
    {0x14, -0.5},   // 00010100b (bit 2,4)
    {0x28,  0.5},   // 00101000b (bit 3,5)
    {0x50,  1.5},   // 01010000b (bit 4,6)
    {0xA0,  2.0},   // 10100000b (bit 5,7)
    // 特殊情况：跨中心的分离检测
    {0x24,  0.0},   // 00100100b (bit 2,5) - 跨中心检测
    {0x42,  0.0},   // 01000010b (bit 1,6) - 跨中心检测
    {0x81,  0.0},   // 10000001b (bit 0,7) - 跨中心检测
#elif (TRACK_SENSOR_COUNT == 9) // ⭐ 9路传感器 (中心: 4)
    // 单个传感器
    {0x001, -4.0f}, // 0b000000001 (bit 0)
    {0x002, -3.0f}, // 0b000000010 (bit 1)
    {0x004, -2.0f}, // 0b000000100 (bit 2)
    {0x008, -1.0f}, // 0b000001000 (bit 3)
    {0x010, 0.0f},  // 0b000010000 (bit 4) ⭐ 中心
    {0x020, 1.0f},  // 0b000100000 (bit 5)
    {0x040, 2.0f},  // 0b001000000 (bit 6)
    {0x080, 3.0f},  // 0b010000000 (bit 7)
    {0x100, 4.0f},  // 0b100000000 (bit 8)
    // 两个传感器
    {0x003, -3.5f}, // 0b000000011 (bit 0,1)
    {0x006, -2.5f}, // 0b000000110 (bit 1,2)
    {0x00C, -1.5f}, // 0b000001100 (bit 2,3)
    {0x018, -0.5f}, // 0b000011000 (bit 3,4)
    {0x030, 0.5f},  // 0b000110000 (bit 4,5)
    {0x060, 1.5f},  // 0b001100000 (bit 5,6)
    {0x0C0, 2.5f},  // 0b011000000 (bit 6,7)
    {0x180, 3.5f},  // 0b110000000 (bit 7,8)
    // 三个传感器
    {0x007, -3.0f}, // 0b000000111 (bit 0,1,2)
    {0x00E, -2.0f}, // 0b000001110 (bit 1,2,3)
    {0x01C, -1.0f}, // 0b000011100 (bit 2,3,4)
    {0x038, 0.0f},  // 0b000111000 (bit 3,4,5) ⭐ 中心
    {0x070, 1.0f},  // 0b001110000 (bit 4,5,6)
    {0x0E0, 2.0f},  // 0b011100000 (bit 5,6,7)
    {0x1C0, 3.0f},  // 0b111000000 (bit 6,7,8)

#elif (TRACK_SENSOR_COUNT == 10) // ⭐ 10路传感器 (中心: 4.5)
    // 单个传感器
    {0x001, -4.5f}, // 0b0000000001 (bit 0)
    {0x002, -3.5f}, // 0b0000000010 (bit 1)
    {0x004, -2.5f}, // 0b0000000100 (bit 2)
    {0x008, -1.5f}, // 0b0000001000 (bit 3)
    {0x010, -0.5f}, // 0b0000010000 (bit 4)
    {0x020, 0.5f},  // 0b0000100000 (bit 5)
    {0x040, 1.5f},  // 0b0001000000 (bit 6)
    {0x080, 2.5f},  // 0b0010000000 (bit 7)
    {0x100, 3.5f},  // 0b0100000000 (bit 8)
    {0x200, 4.5f},  // 0b1000000000 (bit 9)
    // 两个传感器
    {0x003, -4.0f}, // 0b0000000011 (bit 0,1)
    {0x006, -3.0f}, // 0b0000000110 (bit 1,2)
    {0x00C, -2.0f}, // 0b0000001100 (bit 2,3)
    {0x018, -1.0f}, // 0b0000011000 (bit 3,4)
    {0x030, 0.0f},  // 0b0000110000 (bit 4,5) ⭐ 中心
    {0x060, 1.0f},  // 0b0001100000 (bit 5,6)
    {0x0C0, 2.0f},  // 0b0011000000 (bit 6,7)
    {0x180, 3.0f},  // 0b0110000000 (bit 7,8)
    {0x300, 4.0f},  // 0b1100000000 (bit 8,9)
    // 三个传感器
    {0x007, -3.5f}, // 0b0000000111 (bit 0,1,2)
    {0x00E, -2.5f}, // 0b0000001110 (bit 1,2,3)
    {0x01C, -1.5f}, // 0b0000011100 (bit 2,3,4)
    {0x038, -0.5f}, // 0b0000111000 (bit 3,4,5)
    {0x070, 0.5f},  // 0b0001110000 (bit 4,5,6)
    {0x0E0, 1.5f},  // 0b0011100000 (bit 5,6,7)
    {0x1C0, 2.5f},  // 0b0111000000 (bit 6,7,8)
    {0x380, 3.5f},  // 0b1110000000 (bit 7,8,9)

#elif (TRACK_SENSOR_COUNT == 11) // ⭐ 11路传感器 (中心: 5)
    // 单个传感器
    {0x001, -5.0f}, // 0b00000000001 (bit 0)
    {0x002, -4.0f}, // 0b00000000010 (bit 1)
    {0x004, -3.0f}, // 0b00000000100 (bit 2)
    {0x008, -2.0f}, // 0b00000001000 (bit 3)
    {0x010, -1.0f}, // 0b00000010000 (bit 4)
    {0x020, 0.0f},  // 0b00000100000 (bit 5) ⭐ 中心
    {0x040, 1.0f},  // 0b00001000000 (bit 6)
    {0x080, 2.0f},  // 0b00010000000 (bit 7)
    {0x100, 3.0f},  // 0b00100000000 (bit 8)
    {0x200, 4.0f},  // 0b01000000000 (bit 9)
    {0x400, 5.0f},  // 0b10000000000 (bit 10)
    // 两个传感器
    {0x003, -4.5f}, // 0b00000000011 (bit 0,1)
    {0x006, -3.5f}, // 0b00000000110 (bit 1,2)
    {0x00C, -2.5f}, // 0b00000001100 (bit 2,3)
    {0x018, -1.5f}, // 0b00000011000 (bit 3,4)
    {0x030, -0.5f}, // 0b00000110000 (bit 4,5)
    {0x060, 0.5f},  // 0b00001100000 (bit 5,6)
    {0x0C0, 1.5f},  // 0b00011000000 (bit 6,7)
    {0x180, 2.5f},  // 0b00110000000 (bit 7,8)
    {0x300, 3.5f},  // 0b01100000000 (bit 8,9)
    {0x600, 4.5f},  // 0b11000000000 (bit 9,10)
    // 三个传感器
    {0x007, -4.0f}, // 0b00000000111 (bit 0,1,2)
    {0x00E, -3.0f}, // 0b00000001110 (bit 1,2,3)
    {0x01C, -2.0f}, // 0b00000011100 (bit 2,3,4)
    {0x038, -1.0f}, // 0b00000111000 (bit 3,4,5)
    {0x070, 0.0f},  // 0b00001110000 (bit 4,5,6) ⭐ 中心
    {0x0E0, 1.0f},  // 0b00011100000 (bit 5,6,7)
    {0x1C0, 2.0f},  // 0b00111000000 (bit 6,7,8)
    {0x380, 3.0f},  // 0b01110000000 (bit 7,8,9)
    {0x700, 4.0f},  // 0b11100000000 (bit 8,9,10)

#elif (TRACK_SENSOR_COUNT == 12) // ⭐ 12路传感器 (中心: 5.5) - 与您的逻辑类似
    // 单个传感器
    {0x001, -5.5f}, // 0b000000000001 (bit 0)
    {0x002, -4.5f}, // 0b000000000010 (bit 1)
    {0x004, -3.5f}, // 0b000000000100 (bit 2)
    {0x008, -2.5f}, // 0b000000001000 (bit 3)
    {0x010, -1.5f}, // 0b000000010000 (bit 4)
    {0x020, -0.5f}, // 0b000000100000 (bit 5)
    {0x040, 0.5f},  // 0b000001000000 (bit 6)
    {0x080, 1.5f},  // 0b000010000000 (bit 7)
    {0x100, 2.5f},  // 0b000100000000 (bit 8)
    {0x200, 3.5f},  // 0b001000000000 (bit 9)
    {0x400, 4.5f},  // 0b010000000000 (bit 10)
    {0x800, 5.5f},  // 0b100000000000 (bit 11)
    // 两个传感器
    {0x003, -5.0f}, // 0b000000000011 (bit 0,1)
    {0x006, -4.0f}, // 0b000000000110 (bit 1,2)
    {0x00C, -3.0f}, // 0b000000001100 (bit 2,3)
    {0x018, -2.0f}, // 0b000000011000 (bit 3,4)
    {0x030, -1.0f}, // 0b000000110000 (bit 4,5)
    {0x060, 0.0f},  // 0b000001100000 (bit 5,6) ⭐ 中心
    {0x0C0, 1.0f},  // 0b000011000000 (bit 6,7)
    {0x180, 2.0f},  // 0b000110000000 (bit 7,8)
    {0x300, 3.0f},  // 0b001100000000 (bit 8,9)
    {0x600, 4.0f},  // 0b011000000000 (bit 9,10)
    {0xC00, 5.0f},  // 0b110000000000 (bit 10,11)
    // 三个传感器
    {0x007, -4.5f}, // 0b000000000111 (bit 0,1,2)
    {0x00E, -3.5f}, // 0b000000001110 (bit 1,2,3)
    {0x01C, -2.5f}, // 0b000000011100 (bit 2,3,4)
    {0x038, -1.5f}, // 0b000000111000 (bit 3,4,5)
    {0x070, -0.5f}, // 0b000001110000 (bit 4,5,6)
    {0x0E0, 0.5f},  // 0b000011100000 (bit 5,6,7)
    {0x1C0, 1.5f},  // 0b000111000000 (bit 6,7,8)
    {0x380, 2.5f},  // 0b001110000000 (bit 7,8,9)
    {0x700, 3.5f},  // 0b011100000000 (bit 8,9,10)
    {0xE00, 4.5f},  // 0b111000000000 (bit 9,10,11)

#else
#error "TRACK_SENSOR_COUNT must be between 3 and 12."
#endif
};

#endif
